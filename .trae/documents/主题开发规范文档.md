# BroadcastChannel 主题开发规范文档

## 1. 概述

本文档为BroadcastChannel项目的主题开发者提供完整的开发规范和指南，帮助开发者创建符合系统要求的自定义主题。

## 2. 主题目录结构

### 2.1 标准目录结构

```
theme/
├── [主题名称]/
│   ├── theme.json          # 主题配置文件（必需）
│   ├── variables.css       # CSS变量定义（必需）
│   ├── components.css      # 组件样式覆盖（可选）
│   ├── custom.css          # 自定义样式（可选）
│   ├── README.md           # 主题说明文档（推荐）
│   └── assets/             # 主题资源目录（可选）
│       ├── icons/          # 图标文件
│       ├── fonts/          # 字体文件
│       ├── images/         # 图片资源
│       └── preview.png     # 主题预览图
└── theme-registry.json     # 主题注册表（系统文件）
```

### 2.2 文件命名规范

- **主题目录名**：使用小写字母和连字符，如 `ios-style`、`dark-mode`
- **CSS文件**：使用小写字母和连字符，如 `variables.css`、`components.css`
- **资源文件**：保持原有命名，支持中文但推荐英文
- **配置文件**：固定命名 `theme.json`

## 3. 配置文件格式

### 3.1 theme.json 配置文件

```json
{
  "name": "主题内部名称（必需，英文）",
  "displayName": "主题显示名称（必需）",
  "description": "主题描述（可选）",
  "version": "版本号（必需，语义化版本）",
  "author": "作者信息（可选）",
  "homepage": "主题主页（可选）",
  "license": "许可证（可选）",
  "keywords": ["关键词数组（可选）"],
  "variables": {
    "CSS变量定义（必需）": "变量值"
  },
  "assets": {
    "icons": ["图标文件列表（可选）"],
    "fonts": ["字体文件列表（可选）"],
    "images": ["图片文件列表（可选）"]
  },
  "compatibility": {
    "minVersion": "最低兼容版本（可选）",
    "maxVersion": "最高兼容版本（可选）"
  },
  "features": {
    "darkMode": false,
    "animations": true,
    "customFonts": false
  }
}
```

### 3.2 必需的CSS变量

以下CSS变量是主题系统的核心，**必须**在 `variables.css` 中定义：

```css
:root {
  /* 基础颜色 */
  --background-color: #f4f1ec;        /* 页面背景色 */
  --foreground-color: #000000;        /* 主要文字颜色 */
  --highlight-color: orangered;        /* 强调色/链接色 */
  --secondary-color: #999;             /* 次要文字颜色 */
  --border-color: rgba(0, 0, 0, 0.05); /* 边框颜色 */
  
  /* 组件背景 */
  --cell-background-color: #fff;       /* 卡片/单元格背景 */
  --code-background-color: #f9f9f9;    /* 代码块背景 */
  
  /* 尺寸和间距 */
  --box-border-radius: 3px;            /* 盒子圆角 */
  --media-border-radius: 8px;          /* 媒体元素圆角 */
  --dot-size: 8px;                     /* 圆点大小 */
  --box-margin: 10px;                  /* 盒子间距 */
  
  /* 阴影效果 */
  --shadows: 0 1px 2px rgba(0, 0, 0, 0.02), 
             0 2px 4px rgba(0, 0, 0, 0.02), 
             0 4px 8px rgba(0, 0, 0, 0.02), 
             0 8px 16px rgba(0, 0, 0, 0.02);
  
  /* 图标滤镜 */
  --icon-hover-filter: invert(51%) sepia(0%) saturate(0%) 
                       hue-rotate(23deg) brightness(90%) contrast(90%);
  --icon-secondary-filter: invert(97%) sepia(0%) saturate(0%) 
                           hue-rotate(129deg) brightness(86%) contrast(88%);
}
```

### 3.3 可选的CSS变量

可以根据主题需要添加自定义变量：

```css
:root {
  /* 自定义颜色 */
  --accent-color: #007AFF;             /* 辅助强调色 */
  --success-color: #34C759;            /* 成功状态色 */
  --warning-color: #FF9500;            /* 警告状态色 */
  --error-color: #FF3B30;              /* 错误状态色 */
  
  /* 自定义字体 */
  --heading-font: 'SF Pro Display', sans-serif;
  --body-font: 'SF Pro Text', sans-serif;
  --code-font: 'SF Mono', monospace;
  
  /* 自定义动画 */
  --transition-fast: 0.15s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
}
```

## 4. 资源文件存放规范

### 4.1 图标文件

- **格式**：推荐使用SVG格式，支持PNG/JPG
- **命名**：使用描述性名称，如 `arrow-left.svg`、`user-avatar.png`
- **尺寸**：SVG无限制，位图推荐24x24px、48x48px等标准尺寸
- **存放位置**：`assets/icons/` 目录

### 4.2 字体文件

- **格式**：支持WOFF2、WOFF、TTF、OTF
- **命名**：使用字体名称，如 `SF-Pro-Display.woff2`
- **许可证**：确保字体文件有合法使用权限
- **存放位置**：`assets/fonts/` 目录

### 4.3 图片资源

- **格式**：支持PNG、JPG、WebP、SVG
- **优化**：建议压缩图片以减少加载时间
- **命名**：使用描述性名称，如 `background-pattern.png`
- **存放位置**：`assets/images/` 目录

### 4.4 预览图

- **文件名**：固定为 `preview.png`
- **尺寸**：推荐 800x600px
- **内容**：展示主题的主要视觉效果
- **存放位置**：主题根目录 `assets/preview.png`

## 5. 主题注册机制

### 5.1 注册流程

1. **创建主题目录**：在 `theme/` 下创建主题文件夹
2. **编写配置文件**：创建 `theme.json` 配置文件
3. **开发样式文件**：编写 `variables.css` 和其他样式文件
4. **添加资源文件**：放置图标、字体等资源（可选）
5. **更新注册表**：在 `theme-registry.json` 中注册主题
6. **测试验证**：确保主题正常工作

### 5.2 注册表配置

在 `theme/theme-registry.json` 中添加主题信息：

```json
{
  "themes": [
    {
      "name": "default",
      "path": "./default",
      "enabled": true
    },
    {
      "name": "ios",
      "path": "./ios",
      "enabled": true
    },
    {
      "name": "your-theme",
      "path": "./your-theme",
      "enabled": true
    }
  ],
  "defaultTheme": "default"
}
```

## 6. 开发最佳实践

### 6.1 样式开发建议

1. **继承默认样式**：基于默认主题进行修改，而不是完全重写
2. **使用CSS变量**：充分利用CSS变量系统，避免硬编码颜色值
3. **保持一致性**：确保主题内部的视觉风格一致
4. **考虑可访问性**：确保颜色对比度符合无障碍标准
5. **响应式设计**：确保主题在不同设备上都能正常显示

### 6.2 性能优化

1. **资源压缩**：压缩CSS文件和图片资源
2. **按需加载**：只加载必要的资源文件
3. **缓存策略**：合理设置资源缓存
4. **避免重复**：复用现有的CSS变量和样式

### 6.3 兼容性考虑

1. **浏览器支持**：确保主题在主流浏览器中正常工作
2. **版本兼容**：在配置文件中声明兼容的系统版本
3. **降级方案**：为不支持的特性提供降级方案

## 7. 测试和验证

### 7.1 功能测试

1. **主题切换**：验证主题能够正确加载和切换
2. **样式应用**：检查所有页面元素的样式是否正确
3. **资源加载**：确保图标、字体等资源正常加载
4. **响应式**：测试不同屏幕尺寸下的显示效果

### 7.2 质量检查

1. **代码规范**：使用CSS Lint检查代码质量
2. **性能测试**：检查主题对页面加载速度的影响
3. **无障碍测试**：使用无障碍工具检查可访问性

## 8. 示例：iOS风格主题

### 8.1 目录结构

```
theme/ios/
├── theme.json
├── variables.css
├── components.css
├── README.md
└── assets/
    ├── icons/
    │   ├── chevron-right.svg
    │   └── sf-symbols.svg
    ├── fonts/
    │   ├── SF-Pro-Display.woff2
    │   └── SF-Pro-Text.woff2
    └── preview.png
```

### 8.2 配置文件示例

```json
{
  "name": "ios",
  "displayName": "iOS风格主题",
  "description": "模仿iOS系统设计风格的主题",
  "version": "1.0.0",
  "author": "BroadcastChannel Team",
  "keywords": ["ios", "apple", "mobile", "clean"],
  "variables": {
    "--background-color": "#f2f2f7",
    "--foreground-color": "#000000",
    "--highlight-color": "#007AFF",
    "--secondary-color": "#8E8E93",
    "--border-color": "rgba(60, 60, 67, 0.12)",
    "--cell-background-color": "#ffffff",
    "--code-background-color": "#f2f2f7",
    "--box-border-radius": "10px",
    "--media-border-radius": "12px",
    "--dot-size": "6px",
    "--box-margin": "16px",
    "--shadows": "0 1px 3px rgba(0, 0, 0, 0.1)"
  },
  "assets": {
    "fonts": ["SF-Pro-Display.woff2", "SF-Pro-Text.woff2"],
    "icons": ["chevron-right.svg"]
  },
  "features": {
    "darkMode": false,
    "animations": true,
    "customFonts": true
  }
}
```

### 8.3 样式文件示例

**variables.css**
```css
@import url('./assets/fonts/SF-Pro.css');

:root {
  /* iOS风格颜色 */
  --background-color: #f2f2f7;
  --foreground-color: #000000;
  --highlight-color: #007AFF;
  --secondary-color: #8E8E93;
  --border-color: rgba(60, 60, 67, 0.12);
  
  /* iOS风格字体 */
  --heading-font: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
  --body-font: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
  
  /* iOS风格圆角 */
  --box-border-radius: 10px;
  --media-border-radius: 12px;
  
  /* iOS风格阴影 */
  --shadows: 0 1px 3px rgba(0, 0, 0, 0.1);
}

body {
  font-family: var(--body-font);
}

h1, h2, h3, h4, h5, h6 {
  font-family: var(--heading-font);
}
```

## 9. 常见问题解答

### Q: 如何调试主题样式？
A: 可以设置环境变量 `THEME_DEBUG=true` 开启调试模式，系统会输出详细的主题加载信息。

### Q: 主题不生效怎么办？
A: 检查以下几点：
1. 主题是否在注册表中正确注册
2. 配置文件格式是否正确
3. CSS变量是否完整定义
4. 环境变量是否正确设置

### Q: 如何创建暗色主题？
A: 在CSS变量中使用暗色配色方案，并在配置文件中设置 `"darkMode": true`。

### Q: 可以使用外部字体吗？
A: 可以，但需要确保字体文件有合法使用权限，并在 `assets/fonts/` 目录中提供字体文件。

## 10. 更新日志

- **v1.0.0** (2024-01-01): 初始版本，支持基础主题系统
- **v1.1.0** (计划中): 支持暗色模式切换
- **v1.2.0** (计划中): 支持主题在线安装